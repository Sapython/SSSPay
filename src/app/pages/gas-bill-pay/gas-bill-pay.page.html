<app-header [backButton]="true" pageName="Gas & LPG Service"></app-header>
<ion-content>
  <ng-container *ngIf="!lpgFormSubmitted">
    <ion-text>
      <h1>Enter your details</h1>
    </ion-text>
    <form [formGroup]="lpgForm" (ngSubmit)="submitLpgForm()">
      <ion-item>
        <ion-label position="floating">Select Type</ion-label>
        <ion-select
          interface="popover"
          (ionChange)="operatorSelect.value = null"
          #type
        >
          <ion-select-option>Gas</ion-select-option>
          <ion-select-option>LPG</ion-select-option>
        </ion-select>
      </ion-item>
      <ion-item>
        <ion-label position="floating">Select Operator</ion-label>
        <ion-select
          interface="alert"
          formControlName="operator"
          [disabled]="!type.value"
          (ionChange)="onOperatorSelect($event)"
          #operatorSelect
        >
          <ng-container *ngFor="let op of operators">
            <ion-select-option *ngIf="op.category == type.value" [value]="op.id"
              >{{ op.name }}</ion-select-option
            >
          </ng-container>
        </ion-select>
      </ion-item>
      <ng-container *ngIf="operatorSelect.value">
        <ion-item>
          <ion-label position="floating"
            >{{ operator['displayname'] }}</ion-label
          >
          <ion-input type="text" formControlName="canumber"></ion-input>
        </ion-item>
        <ion-item *ngIf="operator['ad1_d_name']">
          <ion-label position="floating"
            >{{ operator['ad1_d_name'] }}</ion-label
          >
          <ion-input type="text" formControlName="ad1"></ion-input>
        </ion-item>
        <ion-item *ngIf="operator['ad2_d_name']">
          <ion-label position="floating"
            >{{ operator['ad2_d_name'] }}</ion-label
          >
          <ion-input type="text" formControlName="ad2"></ion-input>
        </ion-item>
        <ion-item *ngIf="operator['ad3_d_name']">
          <ion-label position="floating"
            >{{ operator['ad3_d_name'] }}</ion-label
          >
          <ion-input type="text" formControlName="ad3"></ion-input>
        </ion-item>
      </ng-container>
      <ion-button type="submit" expand="block" [disabled]="!lpgForm.valid"
        >Next</ion-button
      >
    </form>
  </ng-container>
  <ng-container *ngIf="lpgFormSubmitted">
    <div id="lpg-details">
      <img
        [src]="'assets/gas-images/' + operator.id  + '.png'"
        id="gas-image"
        #gasImage
        (error)="gasImage.src = 'assets/gas-images/default-gas.png'"
      />
      <h2>{{ operator.name}}</h2>
      <div class="detail">
        <h3>Customer ID</h3>
        <p>{{ lpgForm.get('canumber').value }}</p>
      </div>
      <div class="detail">
        <h3>Customer Name</h3>
        <p>{{ customerName }}</p>
      </div>
      <div *ngIf="lpgForm.get('ad1').value" class="detail">
        <h3>{{ operator.ad1_d_name }}</h3>
        <p>{{ lpgForm.get('ad1').value }}</p>
      </div>
      <div *ngIf="lpgForm.get('ad2').value" class="detail">
        <h3>{{ operator.ad2_d_name }}</h3>
        <p>{{ lpgForm.get('ad2').value }}</p>
      </div>
      <div *ngIf="lpgForm.get('ad3').value" class="detail">
        <h3>{{ operator.ad3_d_name }}</h3>
        <p>{{ lpgForm.get('ad3').value }}</p>
      </div>
      <div class="detail">
        <h3>Payable Amount</h3>
        <p>₹{{ amount }}</p>
      </div>
    </div>
    <ion-button expand="block" (click)="recharge()">Pay ₹{{ amount }}</ion-button>
  </ng-container>
</ion-content>
